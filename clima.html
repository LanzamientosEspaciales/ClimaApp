<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clima ‚Ä¢ Las Piedras, Uruguay</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass: rgba(15, 15, 25, 0.45);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text: #e0e0ff;
            --text-light: rgba(220, 220, 255, 0.8);
            --accent: #9d7eff;
            --bg-dark: #0a0a1a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            min-height: 100vh;
            background: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(157, 126, 255, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(100, 80, 200, 0.12) 0%, transparent 20%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        /* Fondos m√°s oscuros y elegantes por clima */
        body.sunny { background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460); }
        body.partly-cloudy { background: linear-gradient(135deg, #16213e, #1e1e3f, #2a1b3d); }
        body.cloudy { background: linear-gradient(135deg, #0f0f1a, #1a1a2e, #16213e); }
        body.rainy { background: linear-gradient(135deg, #0b0b1a, #121828, #1e1e2e); }
        body.stormy { background: linear-gradient(135deg, #0a0a15, #141428, #1c1c2e); }
        body.snowy { background: linear-gradient(135deg, #1e1e2f, #2a2a40, #3a3a55); }
        body.night { background: linear-gradient(135deg, #0a0a1a, #0f0f2b, #1a1a3a); }

        .container { width: 100%; max-width: 1000px; z-index: 2; }
        header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1.8rem;
            text-shadow: 0 4px 20px rgba(0,0,0,0.6);
            background: linear-gradient(135deg, #ffffff, #c0c0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .current-card {
            background: var(--glass);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 28px;
            border: 1px solid var(--glass-border);
            padding: 2.2rem;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            margin-bottom: 2rem;
        }

        .current-card .temp {
            font-size: 6rem;
            font-weight: 700;
            background: linear-gradient(135deg, #e0e0ff, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .current-card .condition {
            font-size: 1.7rem;
            margin: 0.6rem 0 1.2rem;
            opacity: 0.95;
            font-weight: 500;
        }

        .current-card .location {
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 1rem;
            margin-top: 1.8rem;
        }

        .detail-item {
            background: rgba(255,255,255,0.05);
            padding: 1.1rem;
            border-radius: 18px;
            border: 1px solid rgba(255,255,255,0.06);
            backdrop-filter: blur(8px);
        }

        .detail-item strong {
            display: block;
            font-size: 0.88rem;
            opacity: 0.75;
            margin-bottom: 0.4rem;
            font-weight: 500;
        }

        h2 {
            font-size: 1.75rem;
            margin: 2.2rem 0 1.2rem;
            text-align: center;
            font-weight: 600;
            opacity: 0.95;
        }

        /* Pr√≥ximas horas - m√°s compacto y oscuro */
        .hourly-scroll {
            display: flex;
            gap: 1.1rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: none;
        }
        .hourly-scroll::-webkit-scrollbar { display: none; }

        .hour-card {
            background: rgba(30, 30, 60, 0.5);
            border: 1px solid rgba(157, 126, 255, 0.15);
            border-radius: 22px;
            padding: 1.2rem 1rem;
            min-width: 105px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.35s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .hour-card:hover {
            transform: translateY(-10px);
            background: rgba(157, 126, 255, 0.12);
            border-color: var(--accent);
        }

        .hour-card .time {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .hour-card .icon {
            font-size: 2.2rem;
            margin: 0.4rem 0;
        }

        .hour-card .temp {
            font-size: 1.4rem;
            font-weight: 700;
        }

        /* Pron√≥stico extendido */
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.4rem;
            margin-top: 1rem;
        }

        .day-card {
            background: rgba(25, 25, 50, 0.5);
            border: 1px solid rgba(157, 126, 255, 0.15);
            border-radius: 26px;
            padding: 1.6rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            backdrop-filter: blur(12px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
        }

        .day-card:hover {
            transform: translateY(-14px) scale(1.03);
            background: rgba(157, 126, 255, 0.12);
            border-color: var(--accent);
        }

        .day-card h3 {
            font-size: 1.28rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }

        .day-card .icon {
            font-size: 3.2rem;
            margin: 0.6rem 0;
        }

        /* Modal m√°s oscuro y premium */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.88);
            backdrop-filter: blur(14px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .modal.show { opacity: 1; pointer-events: auto; }

        .modal-content {
            background: rgba(20, 20, 40, 0.7);
            border: 1px solid rgba(157, 126, 255, 0.2);
            border-radius: 32px;
            padding: 2.8rem;
            max-width: 580px;
            width: 92%;
            max-height: 92vh;
            overflow-y: auto;
            box-shadow: 0 40px 100px rgba(0,0,0,0.7);
            backdrop-filter: blur(20px);
            position: relative;
        }

        .close {
            position: absolute;
            top: 1.6rem;
            right: 2.2rem;
            font-size: 2.2rem;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            width: 52px;
            height: 52px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close:hover {
            background: #ff4444;
            transform: rotate(90deg) scale(1.1);
        }

        .modal-nav button {
            background: linear-gradient(135deg, var(--accent), #7b68ee);
            border: none;
            color: white;
            padding: 0.9rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(157, 126, 255, 0.3);
            transition: all 0.3s ease;
        }

        .modal-nav button:hover {
            transform: translateY(-5px);
            box-shadow: 0 18px 40px rgba(157, 126, 255, 0.5);
        }

        .modal-hours {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.9rem;
            margin-top: 1.5rem;
            max-height: 340px;
            overflow-y: auto;
            padding-right: 0.4rem;
        }

        .modal-hour {
            background: rgba(157, 126, 255, 0.1);
            border: 1px solid rgba(157, 126, 255, 0.15);
            border-radius: 18px;
            padding: 1rem;
            text-align: center;
            font-size: 0.92rem;
        }

        .last-update {
            text-align: center;
            margin-top: 2rem;
            font-size: 0.88rem;
            opacity: 0.65;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Clima en Las Piedras</h1>
        </header>

        <div id="current-weather" class="current-card"></div>

        <section>
            <h2>Pr√≥ximas horas</h2>
            <div id="hourly" class="hourly-scroll"></div>
        </section>

        <section>
            <h2>Pron√≥stico extendido</h2>
            <div id="forecast" class="forecast-grid"></div>
        </section>

        <div class="last-update" id="last-update"></div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-body"></div>
            <div class="modal-nav" style="display:flex;justify-content:space-between;margin-top:2rem;">
                <button id="prev">‚Üê Anterior</button>
                <button id="next">Siguiente ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        const LAT = -34.72;
        const LON = -56.22;
        let forecastData = [];
        let currentIndex = 0;

        const weatherMap = {
            0: 'sunny', 1: 'partly-cloudy', 2: 'partly-cloudy', 3: 'cloudy',
            45: 'cloudy', 48: 'cloudy', 51: 'rainy', 53: 'rainy', 55: 'rainy',
            61: 'rainy', 63: 'rainy', 65: 'rainy', 71: 'snowy', 73: 'snowy',
            80: 'rainy', 95: 'stormy', 96: 'stormy', 99: 'stormy'
        };

        function getIcon(code) {
            const icons = {
                0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è',
                45: 'üå´', 51: 'üå¶', 53: 'üåß', 55: 'üåß',
                61: 'üåß', 63: 'üåß', 65: '‚õà', 71: 'üå®', 73: 'üå®',
                80: 'üå¶', 95: '‚õà', 96: '‚õà', 99: '‚õà'
            };
            return icons[code] || 'üå§Ô∏è';
        }

        function getCondition(code) {
            const conditions = {
                0: 'Cielo despejado', 1: 'Mayormente despejado', 2: 'Parcialmente nublado', 3: 'Nublado',
                45: 'Niebla', 51: 'Llovizna', 53: 'Llovizna', 55: 'Llovizna intensa',
                61: 'Lluvia ligera', 63: 'Lluvia', 65: 'Lluvia fuerte', 71: 'Nieve ligera',
                73: 'Nieve', 80: 'Chubascos', 95: 'Tormenta', 96: 'Tormenta con granizo'
            };
            return conditions[code] || 'Clima variable';
        }

        async function loadWeather() {
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,cloud_cover,wind_speed_10m&hourly=temperature_2m,weather_code,precipitation_probability&daily=temperature_2m_max,temperature_2m_min,weather_code,precipitation_probability_max,sunrise,sunset&timezone=America/Montevideo&forecast_days=7`;
                
                const res = await fetch(url);
                const data = await res.json();

                document.body.className = '';
                const currentCode = data.current.weather_code;
                const className = weatherMap[currentCode] || 'cloudy';
                document.body.classList.add(className);

                displayCurrent(data.current);
                displayNextHours(data.hourly);
                displayForecast(data.daily);
                document.getElementById("last-update").textContent = `Actualizado: ${new Date().toLocaleTimeString("es-UY", { hour: '2-digit', minute: '2-digit' })}`;
            } catch (err) {
                document.getElementById("current-weather").innerHTML = `<p style="color:#ff6b6b;text-align:center;">Error de conexi√≥n. Recargando...</p>`;
                setTimeout(loadWeather, 5000);
            }
        }

        function displayCurrent(c) {
            const temp = Math.round(c.temperature_2m);
            const feels = Math.round(c.apparent_temperature);
            const icon = getIcon(c.weather_code);
            const condition = getCondition(c.weather_code);

            document.getElementById("current-weather").innerHTML = `
                <div class="icon" style="font-size:5rem;margin-bottom:0.5rem;">${icon}</div>
                <div class="temp">${temp}¬∞</div>
                <div class="condition">${condition}</div>
                <div class="location">Sensaci√≥n ${feels}¬∞ ‚Ä¢ Las Piedras, Uruguay</div>
                <div class="details-grid">
                    <div class="detail-item"><strong>Humedad</strong>${c.relative_humidity_2m}%</div>
                    <div class="detail-item"><strong>Viento</strong>${Math.round(c.wind_speed_10m)} km/h</div>
                    <div class="detail-item"><strong>Nubosidad</strong>${c.cloud_cover}%</div>
                </div>
            `;
        }

        function displayNextHours(hourly) {
            const now = new Date();
            const currentHour = now.getHours();
            const nextHours = [];

            for (let i = 0; i < 8; i++) {
                const hourIndex = (currentHour + i) % 24;
                const dataIndex = now.getMinutes() < 30 ? hourIndex : hourIndex + 1;
                const index = dataIndex >= hourly.time.length ? dataIndex - 24 : dataIndex;
                const timeStr = hourly.time[index];
                const hour = new Date(timeStr).getHours();
                nextHours.push({
                    hour: hour,
                    temp: Math.round(hourly.temperature_2m[index]),
                    code: hourly.weather_code[index],
                    precip: hourly.precipitation_probability?.[index] || 0
                });
            }

            document.getElementById("hourly").innerHTML = nextHours.map(h => `
                <div class="hour-card">
                    <div class="time">${h.hour}:00</div>
                    <div class="icon">${getIcon(h.code)}</div>
                    <div class="temp">${h.temp}¬∞</div>
                    ${h.precip > 20 ? `<div style="font-size:0.8rem;margin-top:4px;opacity:0.8;">${h.precip}% üåß</div>` : ''}
                </div>
            `).join("");
        }

        function displayForecast(daily) {
            forecastData = daily.time.map((date, i) => ({
                date,
                max: Math.round(daily.temperature_2m_max[i]),
                min: Math.round(daily.temperature_2m_min[i]),
                code: daily.weather_code[i],
                precip: daily.precipitation_probability_max[i] || 0
            }));

            document.getElementById("forecast").innerHTML = forecastData.map((d, i) => {
                const date = new Date(d.date);
                const dayName = date.toLocaleDateString("es-UY", { weekday: 'long' }).replace(/^\w/, c => c.toUpperCase());
                const dayNum = date.getDate();
                return `
                    <div class="day-card" onclick="openModal(${i})">
                        <h3>${i === 0 ? "Hoy" : `${dayName.slice(0,3)} ${dayNum}`}</h3>
                        <div class="icon">${getIcon(d.code)}</div>
                        <div style="margin:0.6rem 0;font-size:1.1rem;">${getCondition(d.code)}</div>
                        <div style="font-size:1.5rem;font-weight:700;">
                            ${d.max}¬∞<span style="opacity:0.7;"> / ${d.min}¬∞</span>
                        </div>
                        ${d.precip > 30 ? `<div style="margin-top:0.5rem;font-size:0.9rem;">${d.precip}% üåß</div>` : ''}
                    </div>
                `;
            }).join("");
        }

        function openModal(i) {
            currentIndex = i;
            const day = forecastData[i];
            const date = new Date(day.date).toLocaleDateString("es-UY", { weekday: 'long', day: 'numeric', month: 'long' });
            document.getElementById("modal-body").innerHTML = `
                <h2 style="font-size:2.4rem;margin-bottom:1rem;">${date.charAt(0).toUpperCase() + date.slice(1)}</h2>
                <div style="font-size:5rem;margin:1rem 0;">${getIcon(day.code)}</div>
                <p style="font-size:1.6rem;margin:0.8rem 0;">${getCondition(day.code)}</p>
                <div style="font-size:2.8rem;font-weight:700;margin:1.2rem 0;">
                    ${day.max}¬∞ / ${day.min}¬∞
                </div>
                <div class="details-grid">
                    <div class="detail-item"><strong>Prob. de lluvia</strong>${day.precip}%</div>
                </div>
            `;
            document.getElementById("modal").classList.add("show");
            document.body.style.overflow = "hidden";
        }

        // Cerrar modal
        document.querySelector(".close").onclick = () => {
            document.getElementById("modal").classList.remove("show");
            document.body.style.overflow = "";
        };
        document.getElementById("prev").onclick = () => { if (currentIndex > 0) openModal(currentIndex - 1); };
        document.getElementById("next").onclick = () => { if (currentIndex < forecastData.length - 1) openModal(currentIndex + 1); };
        document.addEventListener("keydown", e => { if (e.key === "Escape") document.querySelector(".close").click(); });

        // Cargar cada 15 minutos
        loadWeather();
        setInterval(loadWeather, 900000);
    </script>
</body>
</html>